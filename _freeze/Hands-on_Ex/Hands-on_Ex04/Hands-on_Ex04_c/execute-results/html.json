{
  "hash": "fb98c46827c1e794028f647968674ab6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on Exercise 04.c\"\nauthor: Johsuan Huang\ndate: 2024-02-05\ndate-modified: \"last-modified\"\ndescription: \"Visualising Uncertainty\"\ncategories: [ggplot2,ggdist, ungeviz]\nexecute:\n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n\n## 1 Learning Outcome\n\nIn this exercise, we will gain hands-on experience on creating statistical graphics for visualising uncertainty. The learning objectives are:\n\n-   plot statistics error bars by using `ggplot2`\n\n-   plot interactive error bars by combining `ggplot2`, `plotly` and `DT`\n\n-   create advanced and more appealing plot by using `ggdist`\n\n-   create hypothetical outcome plots (HOPs) by using `ungeviz` package\n\n## 2 Getting Started\n\n::: panel-tabset\n## Loading the packages\n\nUse the **pacman** package `p_load()` to check, install and launch the following R packages:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(plotly, crosstalk, DT, gganimate,\n               ggdist, tidyverse, ggthemes)\n```\n:::\n\n\n\n| **Library** | **Description** |\n|------------------------------------|------------------------------------|\n| ggdist | a ggplot2 extension spacially desgin for visualising distribution and uncertainty |\n| tidyverse | a family of R packages for data processing |\n| crosstalk | for implementing cross-widget interactions (currently, linked brushing and filtering) |\n\n## Importing the data\n\nIn this exercise, ***Exam_data.csv*** will be used. We use `read_csv()` of **readr** to import the data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam <- read_csv(\"data/Exam_data.csv\")\n```\n:::\n\n\n\n## Examining the data\n\nAfter importing the data, let's examine it to understand its data structure:\n\nThe dataset contains 7 attributes and 322 observations with no missing values.\n\n-   The categorical attributes are: ID, CLASS, GENDER and RACE.\n\n-   The continuous attributes are: MATHS, ENGLISH and SCIENCE.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(exam)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  ID         CLASS GENDER RACE    ENGLISH MATHS SCIENCE\n  <chr>      <chr> <chr>  <chr>     <dbl> <dbl>   <dbl>\n1 Student321 3I    Male   Malay        21     9      15\n2 Student305 3I    Female Malay        24    22      16\n3 Student289 3H    Male   Chinese      26    16      16\n4 Student227 3F    Male   Chinese      27    77      31\n5 Student318 3I    Male   Malay        27    11      25\n6 Student306 3I    Female Malay        31    16      16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(exam)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspc_tbl_ [322 × 7] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ ID     : chr [1:322] \"Student321\" \"Student305\" \"Student289\" \"Student227\" ...\n $ CLASS  : chr [1:322] \"3I\" \"3I\" \"3H\" \"3F\" ...\n $ GENDER : chr [1:322] \"Male\" \"Female\" \"Male\" \"Male\" ...\n $ RACE   : chr [1:322] \"Malay\" \"Malay\" \"Chinese\" \"Chinese\" ...\n $ ENGLISH: num [1:322] 21 24 26 27 27 31 31 31 33 34 ...\n $ MATHS  : num [1:322] 9 22 16 77 11 16 21 18 19 49 ...\n $ SCIENCE: num [1:322] 15 16 16 31 25 16 25 27 15 37 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   ID = col_character(),\n  ..   CLASS = col_character(),\n  ..   GENDER = col_character(),\n  ..   RACE = col_character(),\n  ..   ENGLISH = col_double(),\n  ..   MATHS = col_double(),\n  ..   SCIENCE = col_double()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(exam)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      ID               CLASS              GENDER              RACE          \n Length:322         Length:322         Length:322         Length:322        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n    ENGLISH          MATHS          SCIENCE     \n Min.   :21.00   Min.   : 9.00   Min.   :15.00  \n 1st Qu.:59.00   1st Qu.:58.00   1st Qu.:49.25  \n Median :70.00   Median :74.00   Median :65.00  \n Mean   :67.18   Mean   :69.33   Mean   :61.16  \n 3rd Qu.:78.00   3rd Qu.:85.00   3rd Qu.:74.75  \n Max.   :96.00   Max.   :99.00   Max.   :96.00  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nany(is.na(exam))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n\n## Transforming the data\n\nIn R, factors are used to handle categorical data and ordered variable. As there are categorical attributes in our dataset, we are going to convert their data type from \\<chr\\> to \\<fctr\\>:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol <- c(\"CLASS\",\"GENDER\",\"RACE\")\nexam <- exam %>% mutate(across(all_of(col), as.factor))\n```\n:::\n\n\n\nAfter converting the attributes, let's check the data again:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(exam)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  ID         CLASS GENDER RACE    ENGLISH MATHS SCIENCE\n  <chr>      <fct> <fct>  <fct>     <dbl> <dbl>   <dbl>\n1 Student321 3I    Male   Malay        21     9      15\n2 Student305 3I    Female Malay        24    22      16\n3 Student289 3H    Male   Chinese      26    16      16\n4 Student227 3F    Male   Chinese      27    77      31\n5 Student318 3I    Male   Malay        27    11      25\n6 Student306 3I    Female Malay        31    16      16\n```\n\n\n:::\n:::\n\n\n:::\n\n## 3 Visualizing the uncertainty of point estimates: ggplot2 methods\n\nA point estimate is a single number, such as a mean. Uncertainty, on the other hand, is expressed as standard error, confidence interval, or credible interval.\n\nFirstly, code chunk below will be used to derive the necessary summary statistics.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_sum <- exam %>%\n  group_by(RACE) %>% # group the observation by RACE\n  summarise(n=n(), #sample size \n            mean = mean(MATHS),\n            sd = sd(MATHS)) %>%\n  mutate(se=sd/sqrt(n-1)) #calculate standard error of the sample mean\n\nmy_sum\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 5\n  RACE        n  mean    sd    se\n  <fct>   <int> <dbl> <dbl> <dbl>\n1 Chinese   193  76.5  15.7  1.13\n2 Indian     12  60.7  23.4  7.04\n3 Malay     108  57.4  21.1  2.04\n4 Others      9  69.7  10.7  3.79\n```\n\n\n:::\n:::\n\n\n\nNext, the code chunk below will be used to display *my_sum* tibble data frame in an html table format by using `kable()` function in **knitr.**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(head(my_sum),format = \"html\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> RACE </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n   <th style=\"text-align:right;\"> se </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Chinese </td>\n   <td style=\"text-align:right;\"> 193 </td>\n   <td style=\"text-align:right;\"> 76.50777 </td>\n   <td style=\"text-align:right;\"> 15.69040 </td>\n   <td style=\"text-align:right;\"> 1.132357 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Indian </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 60.66667 </td>\n   <td style=\"text-align:right;\"> 23.35237 </td>\n   <td style=\"text-align:right;\"> 7.041005 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Malay </td>\n   <td style=\"text-align:right;\"> 108 </td>\n   <td style=\"text-align:right;\"> 57.44444 </td>\n   <td style=\"text-align:right;\"> 21.13478 </td>\n   <td style=\"text-align:right;\"> 2.043177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Others </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 69.66667 </td>\n   <td style=\"text-align:right;\"> 10.72381 </td>\n   <td style=\"text-align:right;\"> 3.791438 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### 3.1 Plotting standard error bars of point estimates\n\nNow we are ready to plot the standard error bars of mean maths score by race as shown below.\n\n-   `stat = 'identity'` in the `geom_point()` means that don't apply any statistics, just plot 'mean' values.\n\n-   The error bars are computed by using the formula mean+/-se.\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=RACE,\n        ymin = mean-se,\n        ymax = mean+se),\n    width = 0.2,\n    colour = \"black\",\n    alpha = 0.9,\n    linewidth =0.5)+\n  geom_point(aes(x=RACE,y=mean),\n             stat = 'identity', \n             color = \"#D9A4C3\",\n             size = 1.5, alpha=1)+\n  labs(title = \"Standard Error of Mean Math Score by Race\",\n       subtitle = \"68% Confidence Interval\",\n       y=\"Mean math score\")+\n  theme_wsj(base_size = 9)+\n  theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(hjust=0, face=\"bold\", size = 18),\n        plot.subtitle = element_text(hjust=0, size = 14),\n        axis.title.y = element_text(size = 10),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3)\n        )\n  \n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n### 3.2 Plotting confidence interval of point estimates\n\nInstead of plotting the standard error bar of point estimates, we can also plot the confidence intervals of mean maths score by race.\n\n-   The confidence intervals are computed by using the formula `mean+/-1.96*se`\n\n-   The `reorder(RACE, -mean)` function reorders the `RACE` factor so that the groups with the highest means appear first on the x-axis.\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=reorder(RACE, -mean),\n        ymin = mean-1.96*se,\n        ymax = mean+1.96*se),\n    width = 0.2,\n    colour = \"black\",\n    alpha = 0.9,\n    linewidth =0.5)+\n  geom_point(aes(x=RACE,y=mean),\n             stat = 'identity', \n             color = \"#D9A4C3\",\n             size = 1.5, alpha=1)+\n  labs(title = \"Standard Error of Mean Math Score by Race\",\n       subtitle = \"95% Confidence Interval\",\n       y=\"Mean math score\")+\n  theme_wsj(base_size = 9)+\n  theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(hjust=0, face=\"bold\", size = 18),\n        plot.subtitle = element_text(hjust=0, size = 14),\n        axis.title.y = element_text(size = 10),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3)\n        )\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n### 3.3 Visualizing the uncertainty of point estimates with interactive error bars\n\nIn this section, we will plot interactive error bars for the 99% confidence interval of mean maths score by race as shown in the figure below.\n\n-   **`bscols()`**: This is used to create a layout where the plot occupies 4 columns (out of a 12-column grid) and the data table occupies 8 columns. This is typically used in Shiny apps or R Markdown documents to **create a side-by-side layout**.\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nshared_df = SharedData$new(my_sum) #create new shared data frame\n\nbscols(\n  widths = c(4, 8),  # Set column widths for plot and table 4:8\n  ggplotly(\n    ggplot(shared_df) + \n      geom_errorbar(\n        aes(x = reorder(RACE, -mean),\n            ymin = mean - 2.58 * se,  \n            ymax = mean + 2.58 * se), \n        width = 0.2, \n        colour = \"black\",\n        alpha = 0.9,\n        linewidth = 0.5\n      ) +\n      geom_point(\n        aes(x = RACE, y = mean,\n            text = paste(\"RACE:\", RACE,\n                         \"<br>N:\", n,\n                         \"<br>Avg. Scores:\", round(mean, 2),\n                         \"<br>99% CI:[\", round((mean - 2.58 * se), 2), \",\",\n                         round((mean + 2.58 * se), 2), \"]\")),\n        stat = 'identity', \n        color = \"#D9A4C3\", \n        size = 1.5, \n        alpha = 1\n      ) +\n      labs(x=\"Race\",y=\"Average Scores\",\n           title = \"99% Confidence interval of average /<br>maths scores by race\")+\n      theme_wsj(base_size = 9) + \n      theme(\n        panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\", color = NA),\n        plot.title = element_text(hjust = 0, face = \"bold\", size = 11.5),\n        axis.title.y = element_text(size = 10),\n        axis.title.x = element_text(size = 10),\n        axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1),\n        tooltip = \"text\"\n      )\n  ), \n  DT::datatable(\n    shared_df,\n    rownames = FALSE,\n    class = \"compact\",\n    width = \"100%\",\n    options = list(pageLength = 10, scrollX = TRUE),\n    colnames = c(\"No. of pupils\", \"Avg Scores\", \"Std Dev\", \"Std Error\")\n  ) %>%\n    formatRound(columns = c('mean', 'sd', 'se'), digits = 2)\n)\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"container-fluid crosstalk-bscols\">\n<div class=\"row\">\n<div class=\"col-xs-4\">\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-f08df07e64be1593a005\" style=\"width:100%;height:400px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f08df07e64be1593a005\">{\"x\":{\"data\":[{\"x\":[1,3,4,2],\"y\":[76.507772020725383,60.666666666666671,57.444444444444429,69.666666666666671],\"text\":[\"reorder(RACE, -mean): Chinese<br />mean - 2.58 * se: 73.58629<br />mean + 2.58 * se: 79.42925\",\"reorder(RACE, -mean): Indian<br />mean - 2.58 * se: 42.50087<br />mean + 2.58 * se: 78.83246\",\"reorder(RACE, -mean): Malay<br />mean - 2.58 * se: 52.17305<br />mean + 2.58 * se: 62.71584\",\"reorder(RACE, -mean): Others<br />mean - 2.58 * se: 59.88476<br />mean + 2.58 * se: 79.44858\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"lines\",\"opacity\":0.90000000000000002,\"line\":{\"color\":\"transparent\"},\"error_y\":{\"array\":[2.9214818033281915,18.16579402963913,5.2713960499886028,9.7819093228264933],\"arrayminus\":[2.9214818033281915,18.16579402963913,5.2713960499886028,9.7819093228265004],\"type\":\"data\",\"width\":8.0000000000000089,\"symmetric\":false,\"color\":\"rgba(0,0,0,1)\"},\"set\":\"SharedData377a2951\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null},{\"x\":[1,3,4,2],\"y\":[76.507772020725383,60.666666666666671,57.444444444444429,69.666666666666671],\"text\":[\"RACE: Chinese<br />mean: 76.50777<br />RACE: Chinese <br>N: 193 <br>Avg. Scores: 76.51 <br>99% CI:[ 73.59 , 79.43 ]\",\"RACE: Indian<br />mean: 60.66667<br />RACE: Indian <br>N: 12 <br>Avg. Scores: 60.67 <br>99% CI:[ 42.5 , 78.83 ]\",\"RACE: Malay<br />mean: 57.44444<br />RACE: Malay <br>N: 108 <br>Avg. Scores: 57.44 <br>99% CI:[ 52.17 , 62.72 ]\",\"RACE: Others<br />mean: 69.66667<br />RACE: Others <br>N: 9 <br>Avg. Scores: 69.67 <br>99% CI:[ 59.88 , 79.45 ]\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(217,164,195,1)\",\"opacity\":1,\"size\":5.6692913385826778,\"symbol\":\"circle\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(217,164,195,1)\"}},\"hoveron\":\"points\",\"set\":\"SharedData377a2951\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null}],\"layout\":{\"margin\":{\"t\":50.476048152760484,\"r\":19.200000000000003,\"b\":58.332995435540852,\"l\":47.427480282274814},\"plot_bgcolor\":\"rgba(243,241,233,1)\",\"paper_bgcolor\":\"rgba(243,241,233,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"sans\",\"size\":11.955168119551681},\"title\":{\"text\":\"<b> 99% Confidence interval of average /<br>maths scores by race <\\/b>\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"mono\",\"size\":15.276048152760483},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,4.5999999999999996],\"tickmode\":\"array\",\"ticktext\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"tickvals\":[1,2,3,4],\"categoryorder\":\"array\",\"categoryarray\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(0,0,0,1)\",\"ticklen\":2.9887920298879203,\"tickwidth\":0.54341673270689483,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"sans\",\"size\":11.955168119551681},\"tickangle\":-45,\"showline\":true,\"linecolor\":\"rgba(0,0,0,1)\",\"linewidth\":0.54341673270689483,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Race\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"mono\",\"size\":13.283520132835205}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[40.653487469404261,81.295961157116452],\"tickmode\":\"array\",\"ticktext\":[\"50\",\"60\",\"70\",\"80\"],\"tickvals\":[50,60,70,80],\"categoryorder\":\"array\",\"categoryarray\":[\"50\",\"60\",\"70\",\"80\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":2.9887920298879207,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"sans\",\"size\":11.955168119551683},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(0,0,0,1)\",\"gridwidth\":0.54341673270689483,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Average Scores\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"mono\",\"size\":13.283520132835205}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"transparent\",\"width\":0.54341673270689483,\"linetype\":\"none\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(248,242,228,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.5461703650680028,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"sans\",\"size\":9.5641344956413477}},\"hovermode\":\"closest\",\"barmode\":\"relative\",\"dragmode\":\"zoom\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"372c5f9cd120\":{\"x\":{},\"ymin\":{},\"ymax\":{},\"type\":\"scatter\"},\"372c3065bcea\":{\"x\":{},\"y\":{},\"text\":{}}},\"cur_data\":\"372c5f9cd120\",\"visdat\":{\"372c5f9cd120\":[\"function (y) \",\"x\"],\"372c3065bcea\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0,\"ctGroups\":[\"SharedData377a2951\"]},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n</div>\n<div class=\"col-xs-8\">\n<div id=\"htmlwidget-ca8a26f067002f0bc0c7\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ca8a26f067002f0bc0c7\">{\"x\":{\"crosstalkOptions\":{\"key\":[\"1\",\"2\",\"3\",\"4\"],\"group\":\"SharedData377a2951\"},\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Chinese\",\"Indian\",\"Malay\",\"Others\"],[193,12,108,9],[76.50777202072538,60.66666666666667,57.44444444444443,69.66666666666667],[15.69040284264305,23.35237318418266,21.13478478068459,10.72380529476361],[1.132357288111705,7.041005437844626,2.043176763561474,3.791437722025775]],\"container\":\"<table class=\\\"compact\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>No. of pupils<\\/th>\\n      <th>Avg Scores<\\/th>\\n      <th>Std Dev<\\/th>\\n      <th>Std Error<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":10,\"scrollX\":true,\"columnDefs\":[{\"targets\":2,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[1,2,3,4]},{\"orderable\":false,\"targets\":0},{\"name\":\"RACE\",\"targets\":0},{\"name\":\"n\",\"targets\":1},{\"name\":\"mean\",\"targets\":2},{\"name\":\"sd\",\"targets\":3},{\"name\":\"se\",\"targets\":4}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\"],\"jsHooks\":[]}</script>\n</div>\n</div>\n</div>\n```\n\n:::\n:::\n\n\n\n## 4 Visualising Uncertainty: ggdist package\n\n-   [**ggdist**](https://mjskay.github.io/ggdist/index.html) is an R package that provides a flexible set of ggplot2 geoms and stats designed especially for visualising distributions and uncertainty.\n\n-   It is designed for both **frequentist** and **Bayesian uncertainty** visualization, taking the view that uncertainty visualization can be unified through the perspective of distribution visualization:\n\n    -   **Frequentist models:** Visualizing confidence distributions or bootstrap distributions (see vignette(“freq-uncertainty-vis”));\n\n    -   **Bayesian models**: Visualizing probability distributions (see the tidybayes package, which builds on top of ggdist).\n\n### 4.1 Visualizing the uncertainty of point estimates: ggdist methods\n\nIn the code chunk below, [`stat_pointinterval()`](https://mjskay.github.io/ggdist/reference/stat_pointinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race:\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_pointinterval() +\n  aes(interval_color=stat(level)) +\n  scale_color_manual(\n    values = c(\"grey20\", \"grey50\"), # customize colors for 95% and 99% CI\n    aesthetics = \"interval_color\") +\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot of 66% and 95%\")+\n  theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        legend.background = element_rect(fill = \"#f3f1e9\"),\n        plot.title = element_text(face = \"bold\"),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3))\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\nBelow are some stat_pointinterval() argument\n\n| Argument | Description |\n|------------------------------------|------------------------------------|\n| **.width** | a vector of probabilities to use that determine the widths of the resulting intervals. The default setting is .width = c(0.66, 0.95), meaning plotting 66% CI and 95% CI |\n| **.point** | This argument determines the point summary (typically mean, median, or mode) |\n| **.interval** | It decides the interval type (quantile interval, `qi`; highest-density interval, `hdi`; or highest-density continuous interval, `hdci`). |\n| **orientation** | Whether this geom is drawn horizontally or vertically: `\"horizontal\"` (or `\"y\"`), `\"vertical\"` (or `\"x\"`), NA |\n\nWe are going to customize the arguments we learned above:\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS)) +\n  stat_pointinterval(.width = 0.95,\n                     .point = median,\n                     .interval = qi,\n                     .orientation = \"na\") +\n  labs(\n    title = \"Visualising confidence intervals of median math score\",\n    subtitle = \"Median Point + 95% CI plot\")+\n    theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(face = \"bold\"),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3))\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\nBelow is the multiple CI plot showing both 95% and 99% levels:\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS)) +\n  stat_pointinterval(.width = c(0.95,0.99),\n                     .point = mean,\n                     .interval = qi,\n                     .orientation = \"na\") +\n  aes(interval_color=stat(level)) +\n  scale_color_manual(\n    values = c(\"#6a994e\", \"#E8C8DB\"), # customize colors for 95% and 99% CI\n    aesthetics = \"interval_color\") +\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple of interval plot of 95% and 99% levels\")+\n    theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        legend.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(face = \"bold\"),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3))\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n### 4.2 Visualizing the uncertainty of point estimates: ggdist methods\n\nIn the code chunk below, [`stat_gradientinterval()`](https://mjskay.github.io/ggdist/reference/stat_gradientinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS))+\n  stat_gradientinterval(   \n    fill = \"grey30\",      \n    show.legend = TRUE)+                        \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Gradient + interval plot\")+\n  theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(face = \"bold\"),\n        legend.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        axis.line.x = element_line(linewidth = 0.3),\n        axis.line.y = element_line(linewidth = 0.3))\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n### 4.3 Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\n### 4.3.1 Install and launch the ungeviz package\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"wilkelab/ungeviz\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ungeviz)\n```\n:::\n\n\n\n### 4.3.2 Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\nNext, the code chunk below will be used to build the HOPs.\n\n::: toggle\n<details>\n\n<summary>**Display Code**</summary>\n\n``` r\nggplot(data = exam, \n       (aes(x = factor(RACE), \n            y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, \n    width = 0.05), \n    size = 0.4, \n    color = \"grey40\", \n    alpha = 1/2) +\n  geom_hpline(data = sampler(25, group = RACE), \n              height = 0.6, \n              color = \"#D9A4C3\") +\n  theme_bw() + \n  transition_states(.draw, 1, 3)+\n  labs(x=\"Race\",y=\"Math Score\")+\n  theme(panel.background = element_rect(fill = \"#f3f1e9\"),\n        plot.background = element_rect(fill = \"#f3f1e9\",color = NA),\n        plot.title = element_text(face = \"bold\"))\n```\n\n</details>\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex04_c_files/figure-html/unnamed-chunk-20-1.gif)\n:::\n:::\n\n\n\n## 5 Reference\n\n-   Kam, T.S. (2025). [Visualising Uncertainty](https://r4va.netlify.app/chap11).\n",
    "supporting": [
      "Hands-on_Ex04_c_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<link href=\"../../site_libs/bootstrap-grid-3.4.1/bootstrap-grid.min.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}